#!/bin/sh

selected_song="$(ls --format=single-column -p --recursive "${LUNA_MUSIC_DIR}"| grep -v / | dmenu -b -i -l 10)"
if [ -n "${selected_song}" ];
then
        pidof cmus || screen -dmS 'cmus' /usr/bin/cmus

        while [ 1 ]; do cmus-remote -Q > /dev/null 2>&1 && break; sleep 1 ; done ;

        screen -S 'cmus' -p 0 -X stuff ":clear^M:add ${LUNA_MUSIC_DIR}^M"
        screen -S 'cmus' -p 0 -X stuff "/${selected_song}^M^M"
fi
