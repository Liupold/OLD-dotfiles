#!/bin/sh

open_yt() { command "termux-open" && termux-open $1 && return; yplay "$1"; }
open_audio() { mpv --no-video "$1"; }
open_video() { command "termux-open" && termux-open $1 && return; mpv "$1"; }

open_image() {
        tmp_img="$(mktemp /tmp/XXXXXXXX)"
        wget "$1" -O "$tmp_img" && \
        sxiv "$tmp_img" && rm "$tmp_img"; }

open_pdf() {
        tmp_pdf="$(mktemp /tmp/XXXXXXXX)"
        wget "$1" -O "$tmp_pdf" && \
                zathura "$tmp_pdf" && rm "$tmp_pdf"

}
open_gif() {
        tmp_gif="$(mktemp /tmp/XXXXXXXX)";
         wget "$1" -O "$tmp_gif" && \
                mpv --loop "$tmp_gif" && rm "$tmp_gif"
}


url="$1"
case "${url%%\?*}" in
        https://www.youtube.com/watch?v=* | https://youtu.be/* \
                | https://www.youtube.com/playlist* )
                open_yt "$url"; continue;;
        *.pdf)
                open_pdf "$url"; continue ;;

        *.jpg | *.jpeg | *.png )
                open_image "$url"; continue ;;

        *.mp3 | *.opus | *wav | *.ogg | *.flac )
                open_audio "$url"; continue ;;

        *.mp4 | *.m4a | *.mkv | *.mov | *.webm )
                open_video "$url"; continue ;;

        *.gif )
                open_gif "$url"; continue ;;
        *)
                content_type="$(curl --silent -X HEAD -I "$url" |  \
                        grep 'content-type:')"

                echo "$content_type"

                [ "${content_type##*image}" != "$content_type" ]  \
                        && open_image "$url"

                [ "${content_type##*audio}" != "$content_type" ]  \
                        && open_audio "$url"

                [ "${content_type##*video}" != "$content_type" ]  \
                        && open_video "$url"

                # "${BROWSER?}" "$url"
                continue ;;

esac
